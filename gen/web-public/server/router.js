// Generated by CoffeeScript 1.9.2
(function() {
  var express, gm, multer, router, service;

  express = require('express');

  service = require('./service');

  multer = require('multer');

  gm = require('gm');

  router = express.Router();

  router.use(multer({
    dest: './graphicFiles/',
    onFileUploadComplete: function(file, req, res) {
      return console.log("File upload complete");
    }
  }));

  router.use('/crop', function(req, res, next) {
    var data, fullPath;
    fullPath = "graphicFiles\\" + req.body.imageURL;
    data = req.body.data;
    return gm(fullPath).size(function(err, value) {
      return gm(fullPath).scale(value.width * data.scale, value.height * data.scale).crop(data.w, data.h, data.x, data.y).write(fullPath, function(err) {
        if (err) {
          console.log(err);
        } else {
          console.log("File scaled and cropped");
        }
        return res.send("OK");
      });
    });
  });

  router.use('/uploadGraphic', function(req, res, next) {
    console.log(req.files);
    return res.json({
      result: 'success',
      file: req.files.file.name
    });
  });

  router.use('/getPrivateUserData', function(req, res, next) {
    return res.json({
      data: "This is for private eyes only"
    });
  });

  module.exports = router;

}).call(this);
